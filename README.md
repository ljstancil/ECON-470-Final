# ECON 470 Research Project
## Introduction
This code was created to simulate the job market for interns and investment banks. Similar to the market for Resident Physicians before the advent of the NRMP, the recruiting timeline keeps moving up. Is this really efficient for everyone? We aim to study that question and look at the effects of a clearinghouse. 
## Market
### Market Setup
Let us define a market with six locations denoted $\{ \lambda_1, \dots \lambda_6\}$. Each location has a specific set of sectors that firms will operate in each location. These will be the same for each firm in these sectors. These sectors are A, C, E, F, R, and T, which correspond to Agriculture, Consumer Goods (Technology), Energy, Financial Services, Retail, and Transportation.


### **Banks**
#### *Attributes*
#### **Location**
Each firm is assumed to have an office in $\lambda_1, \lambda_2, \lambda_3$, however it is randomly decided how many/which of the remaining locations they operate in.
#### **Timeline**
Each bank offers their interns at the same time, however banks will offer at different times. In this instance, we have two types: early and late (t=0, t=1). It will be randomly decided at the beginning the types of each bank. This is privately held information.
#### **Sectors**
We can assign sectors to locations instead of banks. This way, if a bank occupies a location, then it has the sectors associated with that sector. The quotas will be randomly generated from 3-10.
#### **Prestige**
Prestige is influenced by others' beliefs about the bank. As such, we will generate a random number between 0 and 1 to serve as the mean for a truncated normal distribution from 0 to 1. This will allow us to simulate the idea that interns will have different ideas regarding the prestige of the banks, but the averages will be the same across interns.
#### **Advancement**
Beliefs about advancement opportunities will likely be generated from their prior interactions with the firm, not necessarily from publicly available information.

#### **Salary**
Prior to the start of the game/matching, each bank independently chooses a salary that they will offer to each of their interns. This is a customary practice. The salary is determined randomly between a range and then ranked accordingly.

### Firm Beliefs and Preferences
#### Resume
The firm's belief regarding the academic aptitude 

### **Interns**
#### *Independently Determined*
#### **Location**
An intern will form a set of locations where they would most want to work. It will be between 3-6, randomly. This is assumed to be known by the firms.
#### **Salary**
Salary rankings are determined by the firms. 
#### **Sectors**
Sector preferences are randomly generated. 
Anywhere from 3-6. This is assumed to be known by the firms.
#### *Firm-Dependent*
#### **Prestige**
Randomly determined for each firm. (no other factors except randomness at this time). Known only to the intern.
#### **Advancement Opportunities**
Randomly determined for each firm. (no other factors except randomness at this time)

## Matching/Assignment Process
### At $t=0$
1. Firms are assigned their locations and corresponding sectors. The quota for each sector is randomly generated $q \in \{ 3, \dots, 10 \}$.The salary for each firm is sampled from a truncated normal distribution in the range $[0,1]$[^1]. The firm's average prestige is sampled from the truncated normal distribution. The firm generates their "company culture" metric by sampling three integers from the uniform distribution on $[0,1000]$ and norming the numbers to sum to 1. Finally, the firm generates a utility function by sampling three integers from the uniform distribution on $[0,1000]$ and norming the numbers to sum to 1. These numbers represent the coefficient the firm assigns to an intern's "academics", "firm fit", and "interview performance".
2. Agents randomly sample an integer over the range $[0,6]$. This is the number of locations that the agent will find acceptable. The agent then randomly samples that number of locations from the list of all locations. Unlike the firms, the only requirement for locations preferences is that they must find at least one location acceptable. The intern then randomly reorders the sector list to determine their preferences over each sector. The agent then generates their beliefs regarding the firm. The agent's belief regarding the prestige of the firm is generated by sampling a truncated normal^[] distribution over $[0,1]$ with $\mu = \rho_k$ where $\rho_k$ is the mean prestige for the firm $\pi_k$. The agent's belief regarding advancement at the firm is sampled from the truncated normal distribution for each firm. We then generate the attributes for the agent.The agent's "academic performance" is randomly sampled from the truncated normal distribution. The agent generates their "behavior" by sampling three integers from the uniform distribution on $[0,1000]$ and norming the numbers to sum to 1. This will be used to determine "firm fit". Finally, the firm generates a utility function by sampling three integers from the uniform distribution on $[0,1000]$ and norming the numbers to sum to 1. Finally, the agent generates a utility function by sampling five integers from the uniform distribution on $[0,1000]$ and norming the numbers to sum to 1.
3. Firms now generate their beliefs about the agents. An intern's "firm fit" is found through the following operation: $$\phi_{k,n} = 1 - \sum \limits_{i = 1}^3 |c_i^{(k) - c_i^{(n)}}|_1$$ where $c_i$ represents the $i-th$ quality. A firm's belief about an agent's "interview performance" is randomly sampled from the truncated normal distribution and is indepedent of any other firm's beliefs.

4. Firms and agents generate their preference lists according to their utility function and beliefs. Firms generate a preference list over all interns (every intern is acceptable). Interns generate a preference list over tuples $(\pi_k, \lambda_i, \sigma_j)$ (we only rank the tuples that exist in this instance of the simulation), and they may not find every combination of firm, location, and sector acceptable.

### **Process (Without Clearinghouse)**
*Note:* In our experiment, a firm was not randomly assigned a type as we iterated through every combination of types. So, this mechanism was run 31 times to generate an expected utility from participating in the mechanism.
#### Assumptions
- Firms can only offer each intern once.
- Firms know an intern's rankings for sector and location, but do not know the intern's respective utility function (i.e. whether an intern values location or sector more).
    - When a firm makes an offer, they offer whatever the most preferred sector is in the most preferred available sector (i.e. they assume that the location is valued more than the sector)
- Firms are location and sector-indfifferent.
- Agents accept their most valued offer at time $t$ and cannot retract that offer or be offered again at time $t + 1$. We only consider an offer when it is acceptable to the intern.
    - We can think of each round as a subgame where the set of available interns $\Pi_{t+1} \sub \Pi_t$

#### Algorithm
The following algorithm is used to determine the outcome of the mechanism:

<img src= 'algorithm_img.png'></img>

What is occurring in this algorithm is that at each time $t$, each firm with $\tau(\pi_k) = t$ is able to participate in the mechanism. We go through the preferences of one firm, and for every agent in their initial quota list, all participants in the current stage are able to offer the agent if she is in their most preferred group at the moment (she is in the first $q$ entries of their preference list, where $q$ is the number of remaining spots they have left). Although it may not be as explicit as it could be in the algorithm, the agent chooses the most preferred out of her offers, which must come from the firms at that time, and they must only offer locations and respective sectors that are available. As previously stated, each firm will first consider her most preferred location and then most preferred sector when they are choosing their offer. This goes on until either there are no available agents for firms (either due to total quantity or because the remaining agents find their open spots unacceptable) to hire or their quotas are filled. We then repeat the process for the firms of $\tau(\pi_k)=t+1$ until all types have been accounted for.

### **Deferred Acceptance Algorithm**

To compare the simulation of the current mechanism to that of a clearinghouse, we implement a form of the Deferred Acceptance Algorithm, or DAA. The DAA was first proposed by Gale-Shapley in 1962, and remains one of the greatest tools for market design. Two oft used examples of the DAA are using it for marriage markets and college admissions, which represent its one-to-one and many-to-one implemenetations. You can read more about the history and basics of DAA by reading [this paper](https://web.stanford.edu/~alroth/papers/GaleandShapley.revised.IJGT.pdf)  written by Alvin Roth in honor of David Gale's 85th birthday. 

#### **Implementation**
We detail the steps on how DAA was implemented in our model. We can obtain a matching using DAA by having each disjoint set propose. In our model, this would mean we have the so-called "agent-proposing" DAA and "firm-proposing" DAA. In our model, we consider each location and sector as a firm  instead of the firm as a whole. For simplicity, we will call these micro-firms. The micro-firms have the same preference list as their parent firm. This allows us to confirm a result from Kojima (2007) to assume strategyproofness and a unique stable matching.

#### **Agent-Proposing**
1. Each agent proposes to their most-preferred micro-firm

    I. The micro-firm "holds" their up to $q$ most-preferred proposals. They then reject the other proposals.
2. Each agent that was rejected in the previous round proposes to their next-preferred firm. If they have run out of firms to propose to that they find acceptable, they are matched to themselves.
    
    I. The micro-firm takes into account their new proposals and once again holds onto their most preferred $q$ agents. 
3. If there are no proposals to be offered in the next round, stop. Otherwise, repeat Step 2 until this criterion is satisfied.


#### **Firm-Proposing**
1. Each firm proposes to their most-preferred $q$ agents

    I. The agent "holds" their most-preferred proposal. They then reject the other proposals.
2. Each firm that was rejected in the previous round proposes to their $q'$ next-preferred agents where $q'$ represents the number of spaces they have left. If they have run out of agents to propose to that they find acceptable, they do not make any more proposals.
    
    I. The agent takes into account their new proposals and once again holds onto their most preferred proposal.
3. If there are no proposals to be offered in the next round, stop. Otherwise, repeat Step 2 until this criterion is satisfied.



#### Comparison

We compare the simulated mechanism to that of DAA. We get the same matching for "agent-proposing" and "firm-proposing" due to the fact that we have a large number of agents and firms. These comparisons are generated in the code and exported to an Excel spreadsheet. We have attached results from one running of the study (meaning only running the study on one set of agents and one set of firms).

## Further Questions/Improvements

- We assume that firms have perfect information regarding behavior and academics for each intern. This isn't true. We can easily change this to a belief and then look at the results. Does this still result in ex-post efficiency/stability? Do we see any change for expected utility (assuming that the student's true types are revealed before calculating the expected utility)? How would confidence intervals play a role for a firm's decisions?
- An agent's opinion can often change in the middle of the recruiting process. However, it is hard to relay that information to firms. How effective are these methods if we allow for some change in the preferences of interns, especially if we institute a rule that allows for some modification of firm's offers as well.
- Recruiters often try to act in their firm's best interest, but a recruiter in NYC may have different priorities than a recruiter in Houston. How can we account for this? Do we have an obligation to take the entire firm's preferences into account? Or is it more reasonable to consider each location and sector as an individual firm and calculate a firm's total utility as an average of all of their sectors?
- How does information play a role in the decisions that firms make? How valuable is it? Would you sacrifice a lower type if you could have more certainty regarding the agent's attributes? From the real world, we see that firms often do sacrifice information in exchange of speed, but is this the best strategy for them?
- What if we had responsive preferences? How does this complicate the model?
- If we reformulate the DAA as a linear program, does our speed increase by a substantial amount? Do we see any change in the results (we shouldn't)


## Sources/Inspiration/Bibliography

[Roth, Alvin E. "Deferred Acceptance Algorithms: History, Theory, Practice, and Open Questions,"
International Journal of Game Theory, Special Issue in Honor of David Gale on his 85th birthday, 36,
March, 2008, 537-569.](https://web.stanford.edu/~alroth/papers/GaleandShapley.revised.IJGT.pdf)

[Haruvy, Ernan, Alvin E. Roth, and M. Utku Ünver. “The Dynamics of Law Clerk Matching: An Experimental and Computational Investigation of Proposals for Reform of the Market.” Journal of Economic Dynamics and Control 30, no. 3 (2006): 457–86. https://doi.org/10.1016/j.jedc.2005.02.002.](https://web.stanford.edu/~alroth/papers/HaruvyRothUnver.JEDC2006.pdf)

[Kojima, Fuhito, and Parag A Pathak. “Incentives and Stability in Large Two-Sided Matching Markets.” American Economic Review 99, no. 3 (2009): 608–27. https://doi.org/10.1257/aer.99.3.608.](http://www.eecs.harvard.edu/cs286r/courses/fall09/papers/kojima_pathak_large.pdf)

[Roth, Alvin E, and Elliott Peranson. “The Redesign of the Matching Market for American Physicians: Some Engineering Aspects of Economic Design.” American Economic Review 89, no. 4 (1999): 748–80. https://doi.org/10.1257/aer.89.4.748.](https://www.nber.org/system/files/working_papers/w6963/w6963.pdf)

[Jay Sethuraman, Chung-Piaw Teo, Liwen Qian, (2006) Many-to-One Stable Matching: Geometry and Fairness. Mathematics of Operations Research 31(3):581-596.
https://doi.org/10.1287/moor.1060.0207](http://www.columbia.edu/~js1353/pubs/qst-many-to-one.pdf)

[Pitchaya Wiratchotisatian, Hoda Atef Yekta, Andrew C. Trapp (2022) Stability Representations of Many-to-One Matching Problems: An Integer Optimization Approach. INFORMS Journal on Computing 34(6):3325-3343.
https://doi.org/10.1287/ijoc.2022.1237
](https://optimization-online.org/wp-content/uploads/2021/02/8272-1.pdf)


[^1]: Any further mention of a truncated normal distribution may be assumed to be the truncated normal distribution over $[0.1]$ with $\mu = 0.5$.
